openapi: 3.0.3
info:
  title: Library API
  version: 1.2.5
  description: STD2269
servers:
  - url: https://library.com
paths:
  /books:
    get:
      tags:
        - Books
      summary: Get all books
      description: The returned books are ordered by updated datetime.
      operationId: getBooks
      parameters:
        - in: query
          name: bookName
          description: Filter return books by given name
          required: false
          schema:
            type: string
        - in: query
          name: releaseDateMin
          description: |
            If  releaseDateMax is not provided, releaseDateMin is ignored.
            releaseDateMin can not be after releaseDateMax.
          schema:
            type: string
            format: date
          required: false
        - in: query
          name: releaseDateMax
          description: |
            If  releaseDateMin is not provided, releaseDateMax is ignored.
            releaseDateMax can not be after releaseDateMin.
          schema:
            type: string
            format: date
          required: false
        - $ref: "#/components/parameters/queryPaginationPage"
        - $ref: "#/components/parameters/queryPaginationPageSize"
      responses:
        200:
          $ref: '#/components/responses/BookList_200'
        400:
          $ref: '#/components/responses/ApiResponse400'
        403:
          $ref: '#/components/responses/ApiResponse403'
        500:
          $ref: '#/components/responses/ApiResponse500'
    put:
      tags:
        - Books
      summary: Create or update a list of books
      operationId: crupdateBooks
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/CrupdateBook'
      responses:
        200:
          $ref: '#/components/responses/BookList_200'
        400:
          $ref: '#/components/responses/ApiResponse400'
        403:
          $ref: '#/components/responses/ApiResponse403'
        500:
          $ref: '#/components/responses/ApiResponse500'
  /books/{bookId}/authors/{authorId}:
    put:
      tags:
        - Books
      summary: Specify book's author
      description: Specify the author of the given books to a given author
      parameters:
        - in: path
          name: bookId 
          description: Id of the book to update 
          required: true 
          schema:
            type: string
        - in: path
          name: authorId 
          description: Id of the author to set in the book 
          required: true 
          schema:
            type: string
      responses:
        200:
          $ref: '#/components/responses/OneBook_200'
        400:
          $ref: '#/components/responses/ApiResponse400'
        403:
          $ref: '#/components/responses/ApiResponse403'
        500:
          $ref: '#/components/responses/ApiResponse500'
  /books/import:
    post:
      tags:
        - Books
      summary: Import a list of books
      operationId: importBooks
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
                - $ref: "#/components/schemas/ImportBook"
                - type: string  
                  format: binary
      responses:
        200:
          $ref: '#/components/responses/BookList_200'
        400:
          $ref: '#/components/responses/ApiResponse400'
        403:
          $ref: '#/components/responses/ApiResponse403'
        500:
          $ref: '#/components/responses/ApiResponse500'
  /books/authors:
    put:
      tags:
        - Books
      summary: Specify a list of books's authors
      description: Specify the authors of a list of books to the given authors
      requestBody:
        description: |
          A list of object which contain the bookId and it's authorId to set
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/UpdateBookAuthor"
        required: true
      responses:
        200:
          $ref: '#/components/responses/BookList_200'
        400:
          $ref: '#/components/responses/ApiResponse400'
        403:
          $ref: '#/components/responses/ApiResponse403'
        500:
          $ref: '#/components/responses/ApiResponse500'
  /authors/{page}/{pageSize}:
    get:
      summary: Get all authors with pagination
      operationId: getAuthorsWithPagination
      tags:
        - Authors
      parameters:
        - name: authorName
          in: query
          description: |
            Filter returned authors by given name. 
            If not provided, then list is not filtered.
          schema:
            type: string
          required: false
        - $ref: "#/components/parameters/pathPaginationPage"
        - $ref: "#/components/parameters/pathPaginationPageSize"
      responses:
        200:
          $ref: '#/components/responses/AuthorList_200'
        400:
          $ref: '#/components/responses/ApiResponse400'
        403:
          $ref: '#/components/responses/ApiResponse403'
        500:
          $ref: '#/components/responses/ApiResponse500'
  /authors:
    get:
      summary: Get all authors
      operationId: getAuthors
      tags:
        - Authors
      parameters:
        - name: authorName
          in: query
          description: |
            Filter returned authors by given name. 
            If not provided, then list is not filtered.
          schema:
            type: string
          required: false
      responses:
        200:
          $ref: '#/components/responses/AuthorList_200'
        400:
          $ref: '#/components/responses/ApiResponse400'
        403:
          $ref: '#/components/responses/ApiResponse403'
        500:
          $ref: '#/components/responses/ApiResponse500'
    put:
      summary: Create or update authors
      operationId: crupdateAuthors
      tags:
        - Authors
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/Author'
      responses:
        200:
          $ref: '#/components/responses/AuthorList_200'
        400:
          $ref: '#/components/responses/ApiResponse400'
        403:
          $ref: '#/components/responses/ApiResponse403'
        500:
          $ref: '#/components/responses/ApiResponse500'
    delete:
      tags:
        - Authors
      summary: Delete many authors
      description: Delete many authors by given's ids in the request body
      operationId: deleteAuthors
      parameters:
        - in: query
          name: authorIds
          description: Ids of authors to delete
          required: true
          schema:
            type: array
            items:
              type: string
      responses:
        200: 
          $ref: '#/components/responses/AuthorList_200'
        400:
          $ref: '#/components/responses/ApiResponse400'
        403:
          $ref: '#/components/responses/ApiResponse403'
        500:
          $ref: '#/components/responses/ApiResponse500'
  /authors/{aId}:
    delete:
      summary: Delete an author
      operationId: deleteAuthor
      tags:
        - Authors
      parameters:
        - name: aId
          in: path
          description: Author identifier to be deleted
          schema:
            type: string
          required: true
      responses:
        200:
          $ref: '#/components/responses/OneAuthor_200'
        400:
          $ref: '#/components/responses/ApiResponse400'
        403:
          $ref: '#/components/responses/ApiResponse403'
        500:
          $ref: '#/components/responses/ApiResponse500'
  /authors/import:
    post:
      tags:
        - Authors
      summary: Import a list of authors
      operationId: importAuthors
      requestBody:
        content:
          application/json:
            schema:
              oneOf:  
                - $ref: "#/components/schemas/ImportAuthor" 
                - type: string  
                  format: binary
      responses:
        200:
          $ref: '#/components/responses/AuthorList_200'
        400:
          $ref: '#/components/responses/ApiResponse400'
        403:
          $ref: '#/components/responses/ApiResponse403'
        500:
          $ref: '#/components/responses/ApiResponse500'
components:
  schemas:
    CrupdateBook:
      type: object
      properties:
        id:
          type: string
        bookName:
          type: string
        pageNumbers:
          type: integer
        topic:
          type: string
          enum:
            - ROMANCE
            - COMEDY
            - OTHER
        releaseDate:
          type: string
          format: date
      required:
        - id
        - bookName
    Book:
      type: object
      allOf:
        - $ref: "#/components/schemas/CrupdateBook"
      properties:
        author:
          $ref: '#/components/schemas/Author'
    Author:
      type: object
      properties:
        id:
          type: string
        authorName:
          type: string
        sex:
          $ref: '#/components/schemas/Sex'
      required:
        - id
        - authorName
    Sex:
      type: string
      enum:
        - M
        - F
    UpdateBookAuthor:
      type: object
      properties:
        bookId:
          type: string
          description: Id of the book to update 
        authorId:
          type: string
          description: Id of the author to set in the book 
      required:
        - bookId
        - authorId
    ImportBook:
      allOf:
        - $ref: "#/components/schemas/CrupdateBook"
      properties:
        authorId:
          type: string
    ImportAuthor:
       allOf:
        - $ref: "#/components/schemas/Author"
    ResponseStatus:
      type: object
      properties:
        code:
          type: integer
          example: 200
        message:
          type: string
          example: OK
    ResponseBodyTemplate:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/ResponseStatus'
        body:
          type: object
    ListOfAuthors:
      allOf:
        - $ref: '#/components/schemas/ResponseBodyTemplate'
        - properties:
            body:
              type: array
              items:
                $ref: '#/components/schemas/Author'
    OneAuthor:
      allOf:
        - $ref: '#/components/schemas/ResponseBodyTemplate'
        - properties:
            body:
              $ref: '#/components/schemas/Author'
    ListOfBooks:
      allOf:
        - $ref: '#/components/schemas/ResponseBodyTemplate'
        - properties:
            body:
              type: array
              items:
                $ref: '#/components/schemas/Book'
    OneBook:
      allOf:
        - $ref: '#/components/schemas/ResponseBodyTemplate'
        - properties:
            body:
              $ref: '#/components/schemas/Book'
    BadRequestBody:
      allOf:
        - $ref: '#/components/schemas/ResponseBodyTemplate'
      example:
        status:
          code: 400
          message: BAD REQUEST
        body: { }
    ForbiddenBody:
      allOf:
        - $ref: '#/components/schemas/ResponseBodyTemplate'
      example:
        status:
          code: 403
          message: FORBIDDEN
        body: { } 
    InternalServerErrorBody:
      allOf:
        - $ref: '#/components/schemas/ResponseBodyTemplate'
      example:
        status:
          code: 500 
          message: INTERNAL SERVER ERROR 
        body: { } 
  responses:
    OneBook_200:
      description: One book is returned
      content:
        appliction/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/OneBook'
    BookList_200:
      description: List of Books
      content:
        appliction/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/ListOfBooks'
    OneAuthor_200:
      description: One author is returned
      content:
        appliction/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/OneAuthor'
    AuthorList_200:
      description: List of Authors 
      content:
        appliction/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/ListOfAuthors'
    ApiResponse400:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/BadRequestBody'
    ApiResponse403:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ForbiddenBody'
    ApiResponse500:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/InternalServerErrorBody'
  parameters:
    queryPaginationPage:
      name: page
      in: query
      schema:
        type: integer
        default: 1
      description: page for the pagination
    queryPaginationPageSize:
      name: pageSize
      in: query
      schema:
        type: integer
        default: 50 
      description: pageSize for the pagination
    pathPaginationPage:
      name: page
      description: Page for pagination
      in: path 
      schema:
        type: integer
        default: 1
      required: true
    pathPaginationPageSize:
      name: pageSize
      description:  pageSize for the pagination
      in: path 
      schema:
        type: integer
        default: 50 
      required: true
 
